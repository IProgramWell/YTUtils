// ==UserScript==
// @name        YT Utils
// @namespace   Violentmonkey Scripts
// @match       https://www.youtube.com/**
// @grant       none
// @version     1.5.6
// @author      -
// @inject-into page
// @run-at      document-start
// @description Useful YouTube utilities.
// @homepageURL https://github.com/IProgramWell/YTUtils
// @downloadURL https://raw.githubusercontent.com/IProgramWell/YTUtils/master/dist/YTUtils.user.js
// ==/UserScript==
(()=>{"use strict";var e={715:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.YTUModule=void 0;const a=o(375),s=l(o(184)),u=i(o(910)),d=i(o(960));class c extends a.AutoBound{constructor(e){if(super(),this.eventHandlers={},this.methods={},this.state={},this.shouldBeActive=()=>!0,this.isActive=!1,this.moduleName=null,this.logger=s.default.GLOBAL_MANAGER,this.utils={urlUtils:u,pageUtils:d},!e.shouldBeActive)throw new Error("Path regex not specified");if(this.shouldBeActive=e.shouldBeActive.bind(this),e.eventHandlers)for(let[t,o]of Object.entries(e.eventHandlers))"function"==typeof o&&(this.eventHandlers[t]=o.bind(this));if(e.methods)for(let[t,o]of Object.entries(e.methods))"function"==typeof o&&(this.methods[t]=o.bind(this));e.logger&&(this.logger=e.logger),e.moduleName&&(this.moduleName=e.moduleName),e.utils&&(this.utils=e.utils)}getStateValue(e,t=null){var o;return null!==(o=this.state[e])&&void 0!==o?o:t}setStateValue(e,t){this.state[e]=t}}t.YTUModule=c,t.default=c},815:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModuleUtils=t.YTUModule=t.MODULES=void 0;var a=o(464);Object.defineProperty(t,"MODULES",{enumerable:!0,get:function(){return l(a).default}});var s=o(715);Object.defineProperty(t,"YTUModule",{enumerable:!0,get:function(){return l(s).default}}),t.ModuleUtils=i(o(403))},464:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(905),i=n(o(715)),l=o(403);t.default=[new i.default({eventHandlers:{onModuleStart:r.noShortsOnURLChange},shouldBeActive:(0,l.activateForRegex)(/^\/shorts\/.*\/?$/i,!1),moduleName:"No Shorts Redirector"}),new i.default({methods:{onPageDataFetch:r.initCustomPlaylistRuntimeDisplay},shouldBeActive:(0,l.activateForRegex)(/^\/playlist\/?$/i,!1),moduleName:"Custom Playlist Statistics"}),new i.default({eventHandlers:{onDocumentLoad:r.noPlaylist.addNoPLControls,onModuleStart:r.noPlaylist.addNoPLControls,onModuleStop:r.noPlaylist.removeNoPLControls},shouldBeActive:r.noPlaylist.shouldBeActiveFor,moduleName:"No Playlist Controls"})]},403:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.activateForRegex=t.onUrlChange=t.callAllModulesMethod=t.onModuleEvent=void 0;const n=o(910);t.onModuleEvent=function(e){var t,o;let r;for(let i of e.moduleList)try{i.isActive!==i.shouldBeActive((0,n.getCurrentLocation)())&&(r=null===(o=(t=i.eventHandlers)[e.eventHandlerName])||void 0===o?void 0:o.call(t,...e.handlerArgs),"boolean"==typeof r&&(i.isActive=r,e.logger.print(`${r?"Started":"Stopped"} module: "${i.moduleName}"`)))}catch(t){e.logger.error(t,i)}},t.callAllModulesMethod=function(e){var t,o;for(let r of e.moduleList)try{e.onlyIfShouldBeActive&&!r.shouldBeActive((0,n.getCurrentLocation)())||null===(o=null===(t=r.methods)||void 0===t?void 0:t[e.methodName])||void 0===o||o.call(t,...e.methodArgs)}catch(t){e.logger.error({err:t,module:r,methodName:e.methodName,methodArgs:e.methodArgs})}},t.onUrlChange=function(e){var t,o;for(let n of e.moduleList)try{n.shouldBeActive(e.currentLocation)?!n.isActive&&n.eventHandlers.onModuleStart&&(n.isActive=n.eventHandlers.onModuleStart(),null===(t=e.logger)||void 0===t||t.print(`Started module: "${n.moduleName}"`)):n.isActive&&n.eventHandlers.onModuleStop&&(n.isActive=n.eventHandlers.onModuleStop(),null===(o=e.logger)||void 0===o||o.print(`Stopped module: "${n.moduleName}"`))}catch(t){e.logger.error(t,n)}},t.activateForRegex=function(e,t=!1){const o="string"==typeof e?new RegExp(e):e;return function(e){const n=e?"string"==typeof e?new URL(e):e:this.utils.urlUtils.getCurrentLocation();return o.test(t?n.href:n.pathname)}}},905:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.noPlaylist=t.noShortsOnURLChange=t.initCustomPlaylistRuntimeDisplay=void 0;var a=o(685);Object.defineProperty(t,"initCustomPlaylistRuntimeDisplay",{enumerable:!0,get:function(){return l(a).default}});var s=o(701);Object.defineProperty(t,"noShortsOnURLChange",{enumerable:!0,get:function(){return l(s).default}}),t.noPlaylist=i(o(534))},534:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBeActiveFor=t.removeNoPLControls=t.addNoPLControls=void 0,t.addNoPLControls=function(){var e,t,o;const{urlUtils:n,pageUtils:r}=this.utils,i="float: left; top: 50%; white-space: nowrap;",l="ytutils-noplaylist-newtabcheckbox",a="ytutils-noplaylist-newtabcheckbox-label",s="ytutils-noplaylist-noplbtn";null===(e=this.setStateValue)||void 0===e||e.call(this,"newTabCheckboxID",l),null===(t=this.setStateValue)||void 0===t||t.call(this,"noPLButtonID",s),null===(o=this.setStateValue)||void 0===o||o.call(this,"newTabCheckboxLabelID",a);const u=["input",{type:"checkbox",id:l,style:`${i} transform: translateY(50%)`,name:l,title:"Open in new tab"}],d=["label",{htmlFor:l,innerHTML:"New tab?",style:i,id:a}],c=["button",{id:s,title:"Watch outside playlist",onclick:()=>{var e;let t=r.getSearchParams();(null===(e=r.queryElement(`#${l}`))||void 0===e?void 0:e.checked)?n.openNewTab(`https://youtube.com/watch?v=${t.v}`):n.setLocationAttribute("search",`?v=${t.v}`)},innerHTML:"No Playlist",style:i}];return r.render(r.queryElement(".ytp-right-controls"),[u,d,c],"start"),!0},t.removeNoPLControls=function(){var e;for(let t of["noPLButtonID","newTabCheckboxID","newTabCheckboxLabelID"])this.utils.pageUtils.removeElementById(null===(e=this.getStateValue)||void 0===e?void 0:e.call(this,t,null));return!1},t.shouldBeActiveFor=function(e){const t=e?"string"==typeof e?new URL(e):e:this.utils.urlUtils.getCurrentLocation();return"/watch"===t.pathname&&!!this.utils.pageUtils.getSearchParams(t).list}},701:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[,e,t]=this.urlUtils.getCurrentLocation().pathname.split("/");return"shorts"===e&&this.utils.urlUtils.navigate(`https://youtube.com/watch?v=${t}`),!0}},685:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=o(928);t.default=function(e){let t=e.detail.pageData.response.contents.twoColumnBrowseResultsRenderer.tabs[0].tabRenderer.content.sectionListRenderer.contents[0].itemSectionRenderer.contents[0].playlistVideoListRenderer.contents.reduce(((e,t)=>{var o,n,r;let i=Number.parseInt(t.playlistVideoRenderer.lengthSeconds),l=i-i*((null===(r=null===(n=null===(o=t.playlistVideoRenderer)||void 0===o?void 0:o.thumbnailOverlays[1])||void 0===n?void 0:n.thumbnailOverlayResumePlaybackRenderer)||void 0===r?void 0:r.percentDurationWatched)||0)/100;return e.total+=i,e.remaining+=l,e}),{total:0,remaining:0}),o=`Runtime: ${n.DateUtils.getTimeString(t.total)}`,r=`Estimated remaining: ${n.DateUtils.getTimeString(t.remaining)}`;this.logger.print({playlistSeconds:t,runtimeString:o,remainingString:r}),e.detail.pageData.response.sidebar.playlistSidebarRenderer.items[0].playlistSidebarPrimaryInfoRenderer.stats.push({simpleText:o},{simpleText:r}),this.logger.print("Added time to playlist!"),this.isActive=!0}},627:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeString=void 0,t.getTimeString=function(e){let t=e,o=Math.floor(t/3600);t%=3600;let n=Math.floor(t/60);return t=Math.round(t%60),[o.toString().padStart(2,"0"),n.toString().padStart(2,"0"),t.toString().padStart(2,"0")].join(":")}},184:(e,t,o)=>{var n,r,i,l;Object.defineProperty(t,"__esModule",{value:!0});const a=o(375);class s extends a.AutoBound{constructor(e,t=!0,o="Locale"){super(),this.scriptName=e,this.logTimestamp=t,this.timestampFormat=o}getTimestamp(){switch(this.timestampFormat){case"UTC":return(new Date).toUTCString();case"ISO":return(new Date).toISOString();case"Locale":return(new Date).toLocaleString();case"Milliseconds":return(new Date).getTime().toString();default:return(new Date).toString()}}joinPrefixes(e,t=!1){return e.map((e=>`[${e}]`)).join(" ")+":"+(t?" ":"")}getPrefix(e=!1,t=!1){return this.joinPrefixes([...e?[this.getTimestamp()]:[],this.scriptName],t)}print(...e){console.log(this.getPrefix(this.logTimestamp,!1),...e)}error(...e){console.error(this.getPrefix(this.logTimestamp,!1),...e)}prompt(e,t,o=!1){return globalThis.prompt(this.getPrefix(o,!0)+e,t)}alert(e,t=!1){globalThis.alert(this.getPrefix(t,!0)+e)}}t.default=s,s.GLOBAL_MANAGER=new s(null!==(l=null===(i=null===(r=null===(n=globalThis.GM_info)||void 0===n?void 0:n.call(globalThis))||void 0===r?void 0:r.script)||void 0===i?void 0:i.name)&&void 0!==l?l:"YT Utils")},375:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.arrToObj=t.AutoBound=t.bindMethods=void 0,t.bindMethods=function(e,t=null,o=null){let n=[];n=e.constructor===Object?Object.keys(e):Object.getOwnPropertyNames(Object.getPrototypeOf(e)),t||(t=e),o||(o=e);for(let r of n)"constructor"!==r&&"function"==typeof e[r]&&(o[r]=e[r].bind(t))};t.AutoBound=class{constructor(){let e=Object.getOwnPropertyNames(Object.getPrototypeOf(this));for(let t of e)"constructor"!==t&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}},t.arrToObj=function(e,t=((e,t)=>t.toString()),o=(e=>e)){const n={};for(let r=0;r<e.length;r++)n[t(e[r],r,e)]=o(e[r],r,e);return n}},960:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.render=t.elementize=t.removeElementById=t.getSearchParams=t.queryAllElements=t.queryElement=void 0;const n=o(375);function r(e){const[t,o,...n]=e,i=Object.assign(document.createElement(t),null!=o?o:{}),l=null==n?void 0:n.reduce(((e,t)=>{if(null!=t)switch(typeof t){case"string":e.push(t);break;case"object":Array.isArray(t)?e.push(r(t)):e.push(t);break;default:e.push(`${t}`)}return e}),[]);return l&&l.length>0&&i.append(...l),i}t.queryElement=function(e){return document.querySelector(e)},t.queryAllElements=function(e){return document.querySelectorAll(e)},t.getSearchParams=function(e=document.location){return(0,n.arrToObj)(e.search.substring(1).split("&"),(e=>e.substring(0,e.indexOf("="))),(e=>e.substring(e.indexOf("=")+1)))},t.removeElementById=function(e){if(!e)return;let t=document.getElementById(e);t&&t.parentNode.removeChild(t)},t.elementize=r,t.render=function(e,t,o="end"){if(!e||!t||0===t.length)return;const n=t.reduce(((e,t)=>(t&&(Array.isArray(t)?e.push(r(t)):e.push(t)),e)),[]);if("start"===o)e.prepend(...n);else e.append(...n)}},150:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(375),i=n(o(184)),l=o(910),a=o(403),s={moduleList:[],logger:i.default.GLOBAL_MANAGER,watchWholeURL:!1,onUrlChange:a.onUrlChange,ObserverClass:MutationObserver};class u extends r.AutoBound{constructor(e=s){super(),this.watchWholeURL=!1,e=Object.assign(Object.assign({},s),e),this.lastURL="",this.observerInstance=new e.ObserverClass(this.onUrlChange),this.logger=e.logger,this.moduleList=e.moduleList,this.watchWholeURL=e.watchWholeURL,this.urlChangeHandler=e.onUrlChange.bind(this)}onUrlChange(){let e=this.watchWholeURL?document.location.href:document.location.pathname;this.lastURL!==e&&(this.lastURL=e,this.logger.print("Changed url!",`New ${this.watchWholeURL?"url":"pathname"}: "${e}"`),this.urlChangeHandler({moduleList:this.moduleList,currentLocation:(0,l.getCurrentLocation)(),logger:this.logger}))}start(){this.observerInstance.observe(document,{subtree:!0,childList:!0,attributeFilter:["location"]})}}t.default=u},910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentLocation=t.openNewTab=t.setLocationAttribute=t.navigate=void 0,t.navigate=function(e){document.location.assign(e.toString())},t.setLocationAttribute=function(e,t){document.location[e]=t},t.openNewTab=function(e){globalThis.GM_openInTab?GM_openInTab(e.toString()):globalThis.open(e.toString(),"_blank")},t.getCurrentLocation=function(){return document.location}},928:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PathWatcher=t.IOManager=t.PageUtils=t.DateUtils=t.ObjUtils=void 0,t.ObjUtils=i(o(375)),t.DateUtils=i(o(627)),t.PageUtils=i(o(960));var a=o(184);Object.defineProperty(t,"IOManager",{enumerable:!0,get:function(){return l(a).default}});var s=o(150);Object.defineProperty(t,"PathWatcher",{enumerable:!0,get:function(){return l(s).default}})}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}(()=>{const e=o(928),t=o(815);new e.PathWatcher({moduleList:t.MODULES,watchWholeURL:!0}).start(),t.ModuleUtils.onModuleEvent({moduleList:t.MODULES,eventHandlerName:"onDocumentStart",handlerArgs:[],logger:e.IOManager.GLOBAL_MANAGER}),globalThis.addEventListener("yt-page-data-fetched",(o=>t.ModuleUtils.callAllModulesMethod({moduleList:t.MODULES,methodName:"onPageDataFetch",methodArgs:[o],logger:e.IOManager.GLOBAL_MANAGER,onlyIfShouldBeActive:!0}))),globalThis.addEventListener("load",(()=>t.ModuleUtils.onModuleEvent({moduleList:t.MODULES,eventHandlerName:"onDocumentLoad",handlerArgs:[],logger:e.IOManager.GLOBAL_MANAGER})))})()})();