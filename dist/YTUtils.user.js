// ==UserScript==
// @name YT Utils
// @namespace Violentmonkey Scripts
// @match https://www.youtube.com/**
// @grant none
// @version 1.5.1
// @author -
// @inject-into page
// @run-at document-start
// @description Useful YouTube utilities.
// @downloadURL https://raw.githubusercontent.com/IProgramWell/YTUtils/master/dist/YTUtils.user.js
// ==/UserScript==
(()=>{"use strict";var e={275:function(e,t,n){var o,i,r,l,a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GLOBAL_WATCHER=t.GLOBAL_MANAGER=void 0;const s=a(n(184)),u=a(n(150)),d=n(815);t.GLOBAL_MANAGER=new s.default(null!==(l=null===(r=null===(i=null===(o=globalThis.GM_info)||void 0===o?void 0:o.call(globalThis))||void 0===i?void 0:i.script)||void 0===r?void 0:r.name)&&void 0!==l?l:"YT Utils"),t.GLOBAL_WATCHER=new u.default(d.MODULES,t.GLOBAL_MANAGER)},715:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(375);class i extends o.AutoBound{constructor(e){if(super(),this.eventHandlers={},this.methods={},this.state={},this.pathRegex=/\//i,this.isActive=!1,this.moduleName=null,!e.pathRegex)throw new Error("Path regex not specified");this.pathRegex="string"==typeof e.pathRegex?new RegExp(e.pathRegex):e.pathRegex;const t=this;Object.assign(this.eventHandlers,(0,o.arrToObj)(Object.entries(e.eventHandlers),(([e])=>e),(([e,n])=>n.bind(t)))),e.methods&&Object.assign(this.methods,(0,o.arrToObj)(Object.entries(e.methods),(([e])=>e),(([e,n])=>n.bind(t)))),e.moduleName&&(this.moduleName=e.moduleName)}getStateValue(e,t=null){var n;return null!==(n=this.state[e])&&void 0!==n?n:t}setStateValue(e,t){this.state[e]=t}}t.default=i},815:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModuleUtils=t.YTUModule=t.MODULES=void 0;var a=n(464);Object.defineProperty(t,"MODULES",{enumerable:!0,get:function(){return l(a).default}});var s=n(715);Object.defineProperty(t,"YTUModule",{enumerable:!0,get:function(){return l(s).default}}),t.ModuleUtils=r(n(403))},464:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(905),r=o(n(715));t.default=[new r.default({eventHandlers:{onModuleStart:i.noShortsOnURLChange},pathRegex:/^\/shorts\/.*\/?$/i,moduleName:"No Shorts Redirector"}),new r.default({eventHandlers:{onPageDataFetch:i.initCustomPlaylistRuntimeDisplay},pathRegex:/^\/playlist\/?$/i,moduleName:"Custom Playlist Statistics"}),new r.default({eventHandlers:{onDocumentLoad:i.noPlaylist.addNoPLControls,onModuleStart:i.noPlaylist.addNoPLControls,onModuleStop:i.noPlaylist.removeNoPLControls},pathRegex:/^\/watch\/?$/i,moduleName:"No Playlist Controls"})]},403:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.onModuleEvent=void 0;const i=o(n(464));t.onModuleEvent=function(e,t,n=!0){var o,r,l;for(let a of i.default)a.pathRegex.test(document.location.pathname)&&a.eventHandlers[e]&&"function"==typeof a.eventHandlers[e]&&(a.isActive=null!==(l=null===(r=(o=a.eventHandlers)[e])||void 0===r?void 0:r.call(o,...t))&&void 0!==l?l:n)}},905:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.noPlaylist=t.noShortsOnURLChange=t.initCustomPlaylistRuntimeDisplay=void 0;var a=n(685);Object.defineProperty(t,"initCustomPlaylistRuntimeDisplay",{enumerable:!0,get:function(){return l(a).default}});var s=n(701);Object.defineProperty(t,"noShortsOnURLChange",{enumerable:!0,get:function(){return l(s).default}}),t.noPlaylist=r(n(534))},534:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeNoPLControls=t.addNoPLControls=void 0;const o=n(960);t.addNoPLControls=function(){var e,t,n;if(!(0,o.getSearchParams)().list)return!1;const i="float: left; top: 50%; white-space: nowrap;",r="ytutils-noplaylist-newtabcheckbox",l="yt-utils-noplaylist-noplbtn";null===(e=this.setStateValue)||void 0===e||e.call(this,"newTabCheckboxID",r),null===(t=this.setStateValue)||void 0===t||t.call(this,"noPLButtonID",l);const a=Object.assign(document.createElement("input"),{type:"checkbox",id:r,style:`${i} transform: translateY(50%);`,name:r,title:"Open in new tab","aria-label":"Open in new tab"}),s=Object.assign(document.createElement("button"),{id:l,title:"Watch outside playlist","aria-label":"Watch outside playlist",onclick:()=>{var e;let t=(0,o.getSearchParams)();(null===(e=document.getElementById(r))||void 0===e?void 0:e.checked)?globalThis.GM_openInTab?GM_openInTab(`https://youtube.com/watch?v=${t.v}`):globalThis.open(`https://youtube.com/watch?v=${t.v}`,"_blank"):document.location.search=`?v=${t.v}`},innerHTML:"No Playlist",style:i});return null===(n=document.querySelector(".ytp-right-controls"))||void 0===n||n.prepend(a,s),!0},t.removeNoPLControls=function(){var e,t;return(0,o.removeElementById)(null===(e=this.getStateValue)||void 0===e?void 0:e.call(this,"newTabCheckboxID",null)),(0,o.removeElementById)(null===(t=this.getStateValue)||void 0===t?void 0:t.call(this,"noPLButtonID",null)),!1}},701:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[,e,t]=document.location.pathname.split("/");return"shorts"===e&&(document.location.href=`https://youtube.com/watch?v=${t}`),!0}},685:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addTimeManually=void 0;const o=n(275),i=n(627);t.default=function(e){let t=e.detail.pageData.response.contents.twoColumnBrowseResultsRenderer.tabs[0].tabRenderer.content.sectionListRenderer.contents[0].itemSectionRenderer.contents[0].playlistVideoListRenderer.contents.reduce(((e,t)=>{var n,i,r;let l=Number.parseInt(t.playlistVideoRenderer.lengthSeconds),a=l-l*((null===(r=null===(i=null===(n=t.playlistVideoRenderer)||void 0===n?void 0:n.thumbnailOverlays[1])||void 0===i?void 0:i.thumbnailOverlayResumePlaybackRenderer)||void 0===r?void 0:r.percentDurationWatched)||0)/100;return o.GLOBAL_MANAGER.print(`Video "${t.playlistVideoRenderer.videoId}"`,`has a remaining watch time of ${a} seconds`,`out of ${l}.`),e.total+=l,e.remaining+=a,e}),{total:0,remaining:0}),n=`Runtime: ${(0,i.getTimeString)(t.total)}`,r=`Estimated remaining: ${(0,i.getTimeString)(t.remaining)}`;return o.GLOBAL_MANAGER.print({playlistSeconds:t,runtimeString:n,remainingString:r}),e.detail.pageData.response.sidebar.playlistSidebarRenderer.items[0].playlistSidebarPrimaryInfoRenderer.stats.push({simpleText:n},{simpleText:r}),o.GLOBAL_MANAGER.print("Added time to playlist!"),!0},t.addTimeManually=function(e,t=!0){try{const n=document.getElementById("stats");return!!n&&(t&&n.innerText.includes(e)||(n.appendChild(Object.assign(document.createElement("yt-formatted-string"),{className:"style-scope ytd-playlist-sidebar-primary-info-renderer"})).innerText=e),!0)}catch(e){return!1}}},627:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeString=void 0,t.getTimeString=function(e){let t=e,n=Math.floor(t/3600);t%=3600;let o=Math.floor(t/60);return t=Math.round(t%60),[n.toString().padStart(2,"0"),o.toString().padStart(2,"0"),t.toString().padStart(2,"0")].join(":")}},184:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(375);class i extends o.AutoBound{constructor(e,t=!0,n="Locale"){super(),this.scriptName=e,this.logTimestamp=t,this.timestampFormat=n}getTimestamp(){switch(this.timestampFormat){case"UTC":return(new Date).toUTCString();case"ISO":return(new Date).toISOString();case"Locale":return(new Date).toLocaleString();case"Milliseconds":return(new Date).getTime().toString();default:return(new Date).toString()}}joinPrefixes(e,t=!1){return e.map((e=>`[${e}]`)).join(" ")+":"+(t?" ":"")}getPrefix(e=!1,t=!1){return this.joinPrefixes([...e?[this.getTimestamp()]:[],this.scriptName],t)}print(...e){console.log(this.getPrefix(this.logTimestamp,!1),...e)}prompt(e,t,n=!1){return globalThis.prompt(this.getPrefix(n,!0)+e,t)}alert(e,t=!1){globalThis.alert(this.getPrefix(t,!0)+e)}}t.default=i},375:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.arrToObj=t.AutoBound=t.bindMethods=void 0,t.bindMethods=function(e,t=null,n=null){let o=[];o=e.constructor===Object?Object.keys(e):Object.getOwnPropertyNames(Object.getPrototypeOf(e)),t||(t=e),n||(n=e);for(let i of o)"constructor"!==i&&"function"==typeof e[i]&&(n[i]=e[i].bind(t))};t.AutoBound=class{constructor(){let e=Object.getOwnPropertyNames(Object.getPrototypeOf(this));for(let t of e)"constructor"!==t&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}},t.arrToObj=function(e,t=((e,t)=>t.toString()),n=(e=>e)){const o={};for(let i=0;i<e.length;i++)o[t(e[i],i,e)]=n(e[i],i,e);return o}},960:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeElementById=t.getSearchParams=void 0;const o=n(375);t.getSearchParams=function(){return(0,o.arrToObj)(document.location.search.substring(1).split("&"),(e=>e.substring(0,e.indexOf("="))),(e=>e.substring(e.indexOf("=")+1)))},t.removeElementById=function(e){if(!e)return;let t=document.getElementById(e);t&&t.parentNode.removeChild(t)}},150:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(375),i=n(275);class r extends o.AutoBound{constructor(e,t=i.GLOBAL_MANAGER){super(),this.lastPath="",this.observerInstance=new MutationObserver(this.onUrlChange),this.logger=t,this.moduleList=e}onUrlChange(){var e,t,n,o,i,r;let l,a=document.location.pathname;if(this.lastPath!==a){this.lastPath=a,this.logger.print("Changed url!",`New pathname: "${a}"`);for(let s of this.moduleList)l=s.pathRegex.test(a),s.isActive&&!l&&s.eventHandlers.onModuleStop?(s.isActive=null!==(n=null===(t=(e=s.eventHandlers).onModuleStop)||void 0===t?void 0:t.call(e))&&void 0!==n&&n,s.isActive||this.logger.print(`Stopped module: "${s.moduleName}" for regex: ${s.pathRegex}`)):!s.isActive&&l&&s.eventHandlers.onModuleStart&&(s.isActive=null===(r=null===(i=(o=s.eventHandlers).onModuleStart)||void 0===i?void 0:i.call(o))||void 0===r||r,s.isActive&&this.logger.print(`Started module: "${s.moduleName}" for regex: ${s.pathRegex}`))}}start(){this.observerInstance.observe(document,{subtree:!0,childList:!0,attributeFilter:["location"]})}}t.default=r}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(()=>{const e=n(275),t=n(815);e.GLOBAL_WATCHER.start(),t.ModuleUtils.onModuleEvent("onDocumentStart",[]),globalThis.addEventListener("yt-page-data-fetched",(e=>t.ModuleUtils.onModuleEvent("onPageDataFetch",[e]))),globalThis.addEventListener("load",(()=>t.ModuleUtils.onModuleEvent("onDocumentLoad",[])))})()})();